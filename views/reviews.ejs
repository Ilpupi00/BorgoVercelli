<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recensioni - ASD BorgoVercelli</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="/stylesheet/Navbar.css" rel="stylesheet" type="text/css">
    <link href="/stylesheet/Footer.css" rel="stylesheet" type="text/css">
    <link href="/stylesheet/reviews.css" rel="stylesheet" type="text/css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="/javascript/reviews.js" type="module" defer></script>
</head>
<body>
    <%- include('partials/navbar') %>

    <main class="container my-5">
        <h1 class="text-center mb-5">Recensioni dei nostri clienti</h1>

        <% if (typeof error !== 'undefined' && error) { %>
            <div class="alert alert-danger" role="alert">
                <%= error %>
            </div>
        <% } else { %>
            <div class="row">
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-body">
                            <h2 class="card-title">Valutazione media</h2>
                            <div class="display-4 text-center mb-3">
                                <span id="averageRating">
                                    <%= (typeof averageRating === 'number' && !isNaN(averageRating)) ? averageRating.toFixed(1) : 'N/A' %>
                                </span>
                                <i class="bi bi-star-fill text-warning"></i>
                            </div>
                            <div id="ratingBars">
                                <% for (let i = 5; i >= 1; i--) { %>
                                    <div class="rating-bar d-flex align-items-center mb-2">
                                        <span class="me-2"><%= i %> <i class="bi bi-star-fill text-warning"></i></span>
                                        <div class="progress flex-grow-1">
                                            <div class="progress-bar bg-warning" role="progressbar" 
                                                 style="width: <%= ((typeof ratingCounts !== 'undefined' && ratingCounts[i]) ? (ratingCounts[i] / totalReviews * 100) : 0).toFixed(2) %>%" 
                                                 aria-valuenow="<%= ((typeof ratingCounts !== 'undefined' && ratingCounts[i]) ? (ratingCounts[i] / totalReviews * 100) : 0).toFixed(2) %>" 
                                                 aria-valuemin="0" aria-valuemax="100"></div>
                                        </div>
                                        <span class="ms-2"><%= (typeof ratingCounts !== 'undefined' && ratingCounts[i]) ? ratingCounts[i] : 0 %></span>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-8">
                    <div class="mb-4">
                        <label for="filterStars" class="form-label">Filtra per stelle:</label>
                        <select class="form-select" id="filterStars">
                            <option value="all">Tutte le recensioni</option>
                            <option value="5">5 stelle</option>
                            <option value="4">4 stelle</option>
                            <option value="3">3 stelle</option>
                            <option value="2">2 stelle</option>
                            <option value="1">1 stella</option>
                        </select>
                    </div>
                    <div id="reviewsContainer">
                        <% if (typeof reviews !== 'undefined' && reviews && reviews.length > 0) { %>
                            <% reviews.forEach(review => { %>
                                <div class="card mb-3 review-card" data-rating="<%= review.valutazione %>">
                                    <div class="card-body">
                                        <h5 class="card-title"><%= review.titolo %></h5>
                                        <p class="card-text"><%= review.contenuto %></p>
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <% for (let i = 1; i <= 5; i++) { %>
                                                    <i class="bi <%= i <= review.valutazione ? 'bi-star-fill' : 'bi-star' %> text-warning"></i>
                                                <% } %>
                                            </div>
                                            <small class="text-muted"><%= new Date(review.data_recensione).toLocaleDateString('it-IT') %></small>
                                        </div>
                                    </div>
                                </div>
                            <% }) %>
                        <% } else { %>
                            <p class="text-center">Nessuna recensione disponibile al momento.</p>
                        <% } %>
                    </div>
                    <div class="text-center mt-4">
                        <button id="loadMoreBtn" class="btn btn-primary">Carica altre recensioni</button>
                    </div>
                </div>
            </div>
        <% } %>
    </main>

    <%- include('partials/footer') %>
</body>
</html>