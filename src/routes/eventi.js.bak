const express = require('express');
const router = express.Router();

module.exports = router;

router.get('/test', async (req, res) => {
  console.log('Route test chiamata');
  res.json([{ id: 1, titolo: 'Test' }]);
});

router.get('/eventi/all', async (req, res) => {
  console.log('Route chiamata');
  res.json([{ id: 1, titolo: 'Test' }]);
});

router.get('/eventi', async (req, res) => {
  try {
    const eventi = await daoEventi.getEventi();
    res.render('eventi', {
      title: 'Eventi - Asd BorgoVercelli 2022',
      eventi: eventi || []
    });
  }
  catch (error) {
    console.error('Errore nel recupero degli eventi:', error);
    res.status(500).render('error', {
      message: 'Errore nel caricamento degli eventi',
      error: process.env.NODE_ENV === 'development' ? error : {}
    });
  }
});

router.get('/evento/visualizza/:id', async (req, res) => {
  try {
    const evento = await daoEventi.getEventoById(req.params.id);
    if (!evento) {
      return res.status(404).render('error', {
        message: 'Evento non trovato',
        error: {}
      });
    }
    res.render('Eventi/visualizza_evento', {
      title: `${evento.titolo} - Asd BorgoVercelli 2022`,
      evento: evento
    });
  } catch (error) {
    console.error('Errore nel recupero dell\'evento:', error);
    res.status(500).render('error', {
      message: 'Errore nel caricamento dell\'evento',
      error: process.env.NODE_ENV === 'development' ? error : {}
    });
  }
});

module.exports = router;