<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Modifica Squadra - <%= squadra ? squadra.nome : 'Squadra' %> - Asd BorgoVercelli 2022</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/stylesheets/Navbar.css">
    <link rel="stylesheet" href="/stylesheets/Footer.css">
    <link rel="stylesheet" href="/stylesheets/Modifica_squadra.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/javascripts/modifica_squadra.js" defer></script>
</head>
<body>
    <%- include('partials/navbar') %>

    <div class="team-management-container">
        <!-- Header Section -->
        <section class="team-header-section">
            <div class="container-fluid">
                <div class="row align-items-center">
                    <div class="col-12 col-md-4 text-center text-md-start mb-3 mb-md-0">
                        <div class="team-logo-container">
                            <% if (squadra && squadra.id_immagine) { %>
                                <img src="/images/<%= squadra.id_immagine %>?t=<%= Date.now() %>"
                                     alt="Logo <%= squadra.nome %>"
                                     class="team-logo">
                            <% } else { %>
                                <div class="team-logo-placeholder">
                                    <i class="fas fa-users"></i>
                                </div>
                            <% } %>
                        </div>
                    </div>
                    <div class="col-12 col-md-8">
                        <h1 class="team-title"><%= squadra ? squadra.nome : 'Nuova Squadra' %></h1>
                        <div class="team-meta">
                            <span class="team-year"><i class="fas fa-calendar-alt"></i> Anno: <%= squadra ? squadra.Anno : '' %></span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container-fluid">
                <!-- Team Details Card -->
                <div class="card team-details-card mb-4">
                    <div class="card-header">
                        <h2 class="card-title"><i class="fas fa-info-circle"></i> Dettagli Squadra</h2>
                    </div>
                    <div class="card-body">
                        <form id="teamForm" class="team-form">
                            <input type="hidden" id="teamId" value="<%= squadra ? squadra.id : '' %>">

                            <div class="row">
                                <div class="col-12 col-md-6 mb-3">
                                    <label for="nomeSquadra" class="form-label">Nome Squadra</label>
                                    <input type="text" class="form-control" id="nomeSquadra"
                                           value="<%= squadra ? squadra.nome : '' %>" required>
                                </div>
                                <div class="col-12 col-md-6 mb-3">
                                    <label for="annoFondazione" class="form-label">Anno Fondazione</label>
                                    <input type="number" class="form-control" id="annoFondazione"
                                           value="<%= squadra ? squadra.Anno : '' %>"
                                           min="1900" max="<%= new Date().getFullYear() %>" required>
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="logoUpload" class="form-label">Logo Squadra</label>
                                <input type="file" class="form-control" id="logoUpload" accept="image/*">
                                <div class="form-text">Seleziona un'immagine (max 5MB)</div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn" id="saveTeamBtn" style="background-color: #4ade80; color: white; border: none;">
                                    <i class="fas fa-save"></i> Salva Modifiche
                                </button>
                                <button type="button" class="btn" id="deleteTeamBtn" style="background-color: #f87171; color: white; border: none;">
                                    <i class="fas fa-trash"></i> Elimina Squadra
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Players Section -->
                <div class="card players-card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h2 class="card-title"><i class="fas fa-users"></i> Giocatori</h2>
                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#addPlayerModal" style="background-color: #4ade80; color: white; border: none;">
                            <i class="fas fa-plus"></i> Aggiungi Giocatore
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="playersList" class="row">
                            <% if (squadra && squadra.giocatori && squadra.giocatori.length > 0) { %>
                                <% squadra.giocatori.forEach(giocatore => { %>
                                <div class="col-12 col-sm-6 col-md-4 mb-3">
                                    <div class="player-card" data-player-id="<%= giocatore.id %>">
                                        <div class="player-avatar">
                                            <% if (giocatore.foto) { %>
                                                <img src="/images/<%= giocatore.foto %>?t=<%= Date.now() %>"
                                                     alt="<%= giocatore.nome %> <%= giocatore.cognome %>">
                                            <% } else { %>
                                                <div class="avatar-placeholder">
                                                    <i class="fas fa-user"></i>
                                                </div>
                                            <% } %>
                                        </div>
                                        <div class="player-info">
                                            <h5><%= giocatore.nome %> <%= giocatore.cognome %></h5>
                                            <p class="role"><%= giocatore.ruolo || 'Giocatore' %></p>
                                        </div>
                                        <div class="player-actions">
                                            <button class="btn btn-outline-primary btn-sm edit-player-btn">
                                                <i class="fas fa-edit"></i>
                                            </button>
                                            <button class="btn btn-outline-danger btn-sm remove-player-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <% }); %>
                            <% } else { %>
                                <div class="col-12 text-center">
                                    <p class="text-muted">Nessun giocatore presente nella squadra.</p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>

                <!-- Managers Section -->
                <div class="card managers-card mb-4">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h2 class="card-title"><i class="fas fa-user-tie"></i> Dirigenti</h2>
                        <button class="btn btn-sm" data-bs-toggle="modal" data-bs-target="#addManagerModal" style="background-color: #4ade80; color: white; border: none;">
                            <i class="fas fa-plus"></i> Aggiungi Dirigente
                        </button>
                    </div>
                    <div class="card-body">
                        <div id="managersList" class="row">
                            <% if (squadra && squadra.dirigenti && squadra.dirigenti.length > 0) { %>
                                <% squadra.dirigenti.forEach(dirigente => { %>
                                <div class="col-12 col-sm-6 col-md-4 mb-3">
                                    <div class="manager-card" data-manager-id="<%= dirigente.id %>">
                                        <div class="manager-avatar">
                                            <% if (dirigente.immagine) { %>
                                                <img src="/images/<%= dirigente.immagine %>?t=<%= Date.now() %>"
                                                     alt="<%= dirigente.nome %> <%= dirigente.cognome %>">
                                            <% } else { %>
                                                <div class="avatar-placeholder">
                                                    <i class="fas fa-user-tie"></i>
                                                </div>
                                            <% } %>
                                        </div>
                                        <div class="manager-info">
                                            <h5><%= dirigente.nome %> <%= dirigente.cognome %></h5>
                                            <p class="role"><%= dirigente.ruolo || 'Dirigente' %></p>
                                            <small class="email"><%= dirigente.email %></small>
                                        </div>
                                        <div class="manager-actions">
                                            <button class="btn btn-outline-danger btn-sm remove-manager-btn">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <% }); %>
                            <% } else { %>
                                <div class="col-12 text-center">
                                    <p class="text-muted">Nessun dirigente presente nella squadra.</p>
                                </div>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Player Modal -->
    <div class="modal fade" id="addPlayerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-plus"></i> Aggiungi Giocatore</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addPlayerForm">
                        <div class="mb-3">
                            <label for="playerNome" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="playerNome" required>
                        </div>
                        <div class="mb-3">
                            <label for="playerCognome" class="form-label">Cognome</label>
                            <input type="text" class="form-control" id="playerCognome" required>
                        </div>
                        <div class="mb-3">
                            <label for="playerRuolo" class="form-label">Ruolo</label>
                            <select class="form-control" id="playerRuolo">
                                <option value="Portiere">Portiere</option>
                                <option value="Difensore">Difensore</option>
                                <option value="Centrocampista">Centrocampista</option>
                                <option value="Attaccante">Attaccante</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="playerFoto" class="form-label">Foto</label>
                            <input type="file" class="form-control" id="playerFoto" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #e5e7eb; color: #374151; border: none;">Annulla</button>
                    <button type="button" class="btn" onclick="addPlayer()" style="background-color: #4ade80; color: white; border: none;">Aggiungi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Player Modal -->
    <div class="modal fade" id="editPlayerModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-edit"></i> Modifica Giocatore</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editPlayerForm">
                        <input type="hidden" id="editPlayerId">
                        <div class="mb-3">
                            <label for="editPlayerNome" class="form-label">Nome</label>
                            <input type="text" class="form-control" id="editPlayerNome" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPlayerCognome" class="form-label">Cognome</label>
                            <input type="text" class="form-control" id="editPlayerCognome" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPlayerRuolo" class="form-label">Ruolo</label>
                            <select class="form-control" id="editPlayerRuolo">
                                <option value="Portiere">Portiere</option>
                                <option value="Difensore">Difensore</option>
                                <option value="Centrocampista">Centrocampista</option>
                                <option value="Attaccante">Attaccante</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="editPlayerFoto" class="form-label">Foto</label>
                            <input type="file" class="form-control" id="editPlayerFoto" accept="image/*">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #e5e7eb; color: #374151; border: none;">Annulla</button>
                    <button type="button" class="btn" onclick="updatePlayer()" style="background-color: #4ade80; color: white; border: none;">Salva</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Manager Modal -->
    <div class="modal fade" id="addManagerModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-user-tie"></i> Aggiungi Dirigente</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label for="managerSearch" class="form-label">Cerca Utente</label>
                        <input type="text" class="form-control" id="managerSearch" placeholder="Digita nome, cognome o email...">
                        <div id="managerSuggestions" class="suggestions-container"></div>
                    </div>
                    <div id="selectedManager" class="selected-user-card d-none">
                        <div class="selected-user-header">
                            <i class="fas fa-user-check"></i>
                            <span>Utente Selezionato</span>
                        </div>
                        <div class="selected-user-info">
                            <div id="selectedManagerName" class="selected-user-name"></div>
                            <div id="selectedManagerEmail" class="selected-user-email"></div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #e5e7eb; color: #374151; border: none;">Annulla</button>
                    <button type="button" class="btn" id="addManagerBtn" onclick="addManager()" disabled style="background-color: #4ade80; color: white; border: none;">Aggiungi</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteConfirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background-color: #ffe6e6; color: #333;">
                    <h5 class="modal-title"><i class="fas fa-exclamation-triangle"></i> Conferma Eliminazione</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p>Sei sicuro di voler eliminare questa squadra? Questa azione non pu√≤ essere annullata.</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn" data-bs-dismiss="modal" style="background-color: #e5e7eb; color: #374151; border: none;">Annulla</button>
                    <button type="button" class="btn" onclick="confirmDelete()" style="background-color: #f87171; color: white; border: none;">Elimina</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Caricamento...</span>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="successToast" class="toast align-items-center" style="color: #6b7280; background-color: #f8fafc; border: 1px solid #86efac;" role="alert">
            <div class="d-flex">
                <div class="toast-body" id="successToastBody"></div>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
        </div>
        <div id="errorToast" class="toast align-items-center" style="color: #6b7280; background-color: #f8fafc; border: 1px solid #fca5a5;" role="alert">
            <div class="d-flex">
                <div class="toast-body" id="errorToastBody"></div>
                <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

    <%- include('partials/footer') %>
    <script src="/javascripts/modifica_squadra.js"></script>
</body>
</html>