<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Notizie - Borgo Vercelli</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-DQvkBjpPgn7RC31MCQoOeC9TI2kdqa4+BSgNMNj8v77fdC77Kj5zpWFTJaaAoMbC" crossorigin="anonymous">
    <link rel="stylesheet" href="/stylesheets/Notizie.css">
    <link rel="stylesheet" href="/stylesheets/Navbar.css">
    <link rel="stylesheet" href="/stylesheets/Footer.css">
</head>
<body>
    <%- include('partials/navbar') %>
    <div id="page">
        <header class="hero-section">
            <div class="container-fluid">
                <div class="row align-items-center min-vh-50">
                    <div class="col-12 text-center">
                        <h1 class="display-4 fw-bold text-dark mb-4 animate__animated animate__fadeInDown">
                            <i class="bi bi-newspaper me-3"></i>Notizie del Borgo
                        </h1>
                        <p class="lead text-muted animate__animated animate__fadeInUp">
                            Rimani aggiornato sulle ultime novità della nostra società
                        </p>
                    </div>
                </div>
            </div>
        </header>

        <main class="main-content">
            <div class="container">
                <!-- Search and Filters Section -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="search-filters-card animate__animated animate__fadeInUp">
                            <div class="row g-3">
                                <!-- Campo ricerca - sempre full width su mobile -->
                                <div class="col-12 col-md-4">
                                    <div class="search-input-group">
                                        <i class="bi bi-search search-icon"></i>
                                        <input type="text" id="searchInput" class="form-control search-input" placeholder="Cerca nelle notizie...">
                                        <button id="clearSearch" class="btn btn-outline-secondary clear-btn" style="display: none;">
                                            <i class="bi bi-x"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Bottone cerca - full width su mobile, piccolo su desktop -->
                                <div class="col-12 col-md-2">
                                    <button id="searchBtn" class="btn btn-primary search-button w-100">
                                        <i class="bi bi-search me-2"></i>
                                        <span class="search-text">Cerca</span>
                                    </button>
                                </div>

                                <!-- Filtri - stacked su mobile -->
                                <div class="col-12 col-md-3">
                                    <select id="authorFilter" class="form-select filter-select">
                                        <option value="">Tutti gli autori</option>
                                        <!-- Autori verranno popolati dinamicamente -->
                                    </select>
                                </div>
                                <div class="col-12 col-md-3">
                                    <select id="dateFilter" class="form-select filter-select">
                                        <option value="">Tutte le date</option>
                                        <option value="oggi">Oggi</option>
                                        <option value="settimana">Questa settimana</option>
                                        <option value="mese">Questo mese</option>
                                        <option value="anno">Quest'anno</option>
                                        <option value="custom">Data personalizzata</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row mt-3" id="customDateRange" style="display: none;">
                                <div class="col-md-3">
                                    <label for="startDate" class="form-label small">Da</label>
                                    <input type="date" id="startDate" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-3">
                                    <label for="endDate" class="form-label small">A</label>
                                    <input type="date" id="endDate" class="form-control form-control-sm">
                                </div>
                                <div class="col-md-3 d-flex align-items-end">
                                    <button id="applyDateFilter" class="btn btn-primary btn-sm">Applica</button>
                                </div>
                            </div>
                            <div class="row mt-2">
                                <div class="col-12">
                                    <div class="active-filters" id="activeFilters"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-12">
                        <div class="notizie-grid" id="notizieContainer">
                            <% const initialNews = notizie.slice(0, 6); %>
                            <% initialNews.forEach(notizia => { %>
                                <article class="notizia-card animate__animated animate__fadeInUp">
                                    <div class="card-image">
                                        <img src="<%= notizia.immagine && notizia.immagine.url && notizia.immagine.url.trim() !== '' ? notizia.immagine.url : '/images/default-news.jpg' %>"
                                             alt="<%= notizia.titolo %>"
                                             class="card-img">
                                        <div class="card-overlay">
                                            <span class="read-more-btn">
                                                <i class="bi bi-eye"></i> Leggi
                                            </span>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <div class="card-meta">
                                            <span class="date">
                                                <i class="bi bi-calendar-event"></i>
                                                <%= new Date(notizia.data_pubblicazione).toLocaleDateString('it-IT', { year: 'numeric', month: 'long', day: 'numeric' }) %>
                                            </span>
                                        </div>
                                        <h3 class="card-title"><%= notizia.titolo %></h3>
                                        <p class="card-excerpt">
                                            <%= notizia.contenuto.replace(/<[^>]*>/g, '').length > 120 ? notizia.contenuto.replace(/<[^>]*>/g, '').substring(0, 120) + '...' : notizia.contenuto.replace(/<[^>]*>/g, '') %>
                                        </p>
                                        <a href="/notizia/<%= notizia.id || notizia.N_id %>" class="btn btn-primary read-full-btn">
                                            <i class="bi bi-arrow-right me-2"></i>Leggi tutto
                                        </a>
                                    </div>
                                </article>
                            <% }); %>
                        </div>

                        <% if (notizie.length > 6) { %>
                            <div class="text-center mt-4">
                                <button id="loadMoreBtn" class="btn-load-more">
                                    <i class="bi bi-plus-circle"></i> Carica altre notizie
                                </button>
                            </div>
                        <% } %>

                        <% if (notizie.length === 0) { %>
                            <div class="no-news text-center">
                                <i class="bi bi-newspaper display-1 text-muted mb-4"></i>
                                <h3 class="text-muted">Nessuna notizia disponibile</h3>
                                <p class="text-muted">Torna presto per le ultime novità!</p>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </main>
    </div>
    <%- include('partials/footer') %>

    <script src="/javascripts/notizie.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js" integrity="sha384-YUe2LzesAfftltw+PEaao2tjU/QATaW/rOitAq67e0CT0Zi2VVRL0oC4+gAaeBKu" crossorigin="anonymous"></script>
</body>
</html>