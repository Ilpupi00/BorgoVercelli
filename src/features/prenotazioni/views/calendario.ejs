<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario Prenotazioni</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <%- include('../../shared/views/partials/theme-includes') %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/assets/styles/scroll-animations.css">
    <link rel="stylesheet" href="/assets/styles/calendario.css">
</head>
<body>
    <div class="calendario-wrapper">
        <!-- Header -->
        <header class="calendario-header reveal reveal--fade-up">
            <div class="header-content">
                <div class="header-left">
                    <a href="/admin/prenotazioni" class="btn-back" title="Torna indietro">
                        <i class="bi bi-arrow-left"></i>
                    </a>
                    <div class="header-title">
                        <h1><i class="bi bi-calendar3-event me-2"></i>Calendario Prenotazioni</h1>
                        <p class="subtitle">Visualizza e gestisci le prenotazioni dei campi</p>
                    </div>
                </div>
                <div class="header-actions">
                    <button id="exportReportBtn" class="btn btn-export">
                        <i class="bi bi-file-earmark-excel me-1"></i><span class="d-none d-md-inline">Report Excel</span>
                    </button>
                    <button id="todayBtn" class="btn btn-today">
                        <i class="bi bi-calendar-day me-1"></i><span class="d-none d-sm-inline">Oggi</span>
                    </button>
                    <button id="theme-toggle" class="btn btn-icon" title="Cambia tema">
                        <i class="bi bi-circle-half"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- Filters & Navigation -->
        <section class="calendario-controls reveal reveal--fade-up reveal--delay-1">
            <div class="controls-wrapper">
                <!-- Month Navigation -->
                <div class="month-navigation">
                    <button id="prevMonth" class="btn-nav" title="Mese precedente">
                        <i class="bi bi-chevron-left"></i>
                    </button>
                    <h2 id="currentMonth" class="month-title">Gennaio 2025</h2>
                    <button id="nextMonth" class="btn-nav" title="Mese successivo">
                        <i class="bi bi-chevron-right"></i>
                    </button>
                </div>

                <!-- Filters -->
                <div class="filters">
                    <div class="filter-group">
                        <label for="campoFilter" class="filter-label">
                            <i class="bi bi-geo-alt me-1"></i>Campo
                        </label>
                        <select id="campoFilter" class="filter-select">
                            <option value="">Tutti i campi</option>
                            <% if (campi && campi.length > 0) { %>
                                <% campi.forEach(campo => { %>
                                    <option value="<%= campo.id %>"><%= campo.nome %></option>
                                <% }); %>
                            <% } %>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="statoFilter" class="filter-label">
                            <i class="bi bi-filter me-1"></i>Stato
                        </label>
                        <select id="statoFilter" class="filter-select">
                            <option value="">Tutti gli stati</option>
                            <option value="confermata">Confermata</option>
                            <option value="in_attesa">In Attesa</option>
                            <option value="annullata">Annullata</option>
                        </select>
                    </div>
                </div>
            </div>
        </section>

        <!-- Calendar Grid -->
        <section class="calendario-grid-section">
            <div class="calendar-container">
                <!-- Days of week header -->
                <div class="calendar-header-days">
                    <div class="day-header">Lun</div>
                    <div class="day-header">Mar</div>
                    <div class="day-header">Mer</div>
                    <div class="day-header">Gio</div>
                    <div class="day-header">Ven</div>
                    <div class="day-header">Sab</div>
                    <div class="day-header">Dom</div>
                </div>
                <!-- Days grid - populated by JS -->
                <div id="calendarDays" class="calendar-days">
                    <!-- Populated by JavaScript -->
                </div>
            </div>

            <!-- Legend -->
            <div class="calendar-legend" role="list" aria-label="Legenda prenotazioni">
                <h3 class="legend-title">Legenda</h3>
                <div class="legend-items">
                    <div class="legend-item" data-status="confermata" data-color-name="Verde" role="listitem" aria-label="Prenotazione confermata">
                        <span class="badge badge-confermata" aria-hidden="true"></span>
                        <div class="legend-text">
                            <div class="legend-label">Confermata</div>
                            <div class="legend-desc">Prenotazione confermata — campo occupato</div>
                        </div>
                    </div>
                    <div class="legend-item" data-status="in_attesa" data-color-name="Arancione" role="listitem" aria-label="Prenotazione in attesa">
                        <span class="badge badge-in-attesa" aria-hidden="true"></span>
                        <div class="legend-text">
                            <div class="legend-label">In Attesa</div>
                            <div class="legend-desc">Richiesta non ancora confermata dall'admin</div>
                        </div>
                    </div>
                    <div class="legend-item" data-status="annullata" data-color-name="Rosso" role="listitem" aria-label="Prenotazione annullata">
                        <span class="badge badge-annullata" aria-hidden="true"></span>
                        <div class="legend-text">
                            <div class="legend-label">Annullata</div>
                            <div class="legend-desc">Prenotazione annullata — slot libero</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Day Detail Modal -->
        <div id="dayModal" class="modal-overlay" style="display: none;">
            <div class="modal-container">
                <div class="modal-header">
                    <h3 id="modalTitle" class="modal-title">Prenotazioni del giorno</h3>
                    <button id="closeModal" class="btn-close-modal" title="Chiudi">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="modal-body" id="modalBody">
                    <!-- Populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Export Report Modal -->
        <div id="exportModal" class="modal-overlay" style="display: none;">
            <div class="modal-container">
                <div class="modal-header">
                    <h3 class="modal-title">
                        <i class="bi bi-file-earmark-excel me-2"></i>Esporta Report Prenotazioni
                    </h3>
                    <button id="closeExportModal" class="btn-close-modal" title="Chiudi">
                        <i class="bi bi-x-lg"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="exportForm" class="export-form">
                        <div class="form-group mb-3">
                            <label for="dataInizio" class="form-label">
                                <i class="bi bi-calendar-event me-1"></i>Data Inizio
                            </label>
                            <input type="date" class="form-control" id="dataInizio" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="dataFine" class="form-label">
                                <i class="bi bi-calendar-event-fill me-1"></i>Data Fine
                            </label>
                            <input type="date" class="form-control" id="dataFine" required>
                        </div>
                        <div class="form-group mb-3">
                            <label for="campoExport" class="form-label">
                                <i class="bi bi-geo-alt me-1"></i>Campo (opzionale)
                            </label>
                            <select id="campoExport" class="form-select">
                                <option value="">Tutti i campi</option>
                                <% if (campi && campi.length > 0) { %>
                                    <% campi.forEach(campo => { %>
                                        <option value="<%= campo.id %>"><%= campo.nome %></option>
                                    <% }); %>
                                <% } %>
                            </select>
                        </div>
                        <div class="form-group mb-4">
                            <label for="statoExport" class="form-label">
                                <i class="bi bi-filter me-1"></i>Stato (opzionale)
                            </label>
                            <select id="statoExport" class="form-select">
                                <option value="">Tutti gli stati</option>
                                <option value="confermata">Solo Confermate</option>
                                <option value="in_attesa">Solo In Attesa</option>
                                <option value="annullata">Solo Annullate</option>
                            </select>
                        </div>
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="bi bi-download me-2"></i>Scarica Report Excel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Pass data to JavaScript -->
    <script>
        window.prenotazioniData = <%- JSON.stringify(prenotazioni || []) %>;
        window.campiData = <%- JSON.stringify(campi || []) %>;
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/assets/scripts/scroll-reveal.js"></script>
    <script src="/assets/scripts/calendario.js"></script>
</body>
</html>