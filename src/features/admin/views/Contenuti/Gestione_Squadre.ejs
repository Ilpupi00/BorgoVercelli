<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestione Squadre - Admin</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <%- include('../../shared/views/partials/theme-includes') %>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet">
    <%- include('../../shared/views/partials/theme-includes') %>
    <link rel="stylesheet" href="/assets/styles/scroll-animations.css">
    <!-- Stili globali admin -->
    <link rel="stylesheet" href="/assets/styles/Admin.css">
    <link rel="stylesheet" href="/assets/styles/Admin_Global.css">
    <link rel="stylesheet" href="/assets/styles/Admin_Table_Responsive.css">
    <link rel="stylesheet" href="/assets/styles/theme-admin.css">
    <!-- Stili specifici pagina -->
    <link rel="stylesheet" href="/assets/styles/Gestione_Squadre.css">
</head>
<body>

    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <%- include('partials/sidebar.ejs'); %>

            <!-- Contenuto principale -->
            <main class="col-lg-9 col-xl-10 px-4 py-5">
                <div class="admin-container">

                    <!-- Header -->
                    <header class="admin-page-header reveal reveal--fade-up">
                        <div class="admin-page-header-content">
                            <h1>
                                <i class="bi bi-people-fill"></i>
                                Gestione Squadre
                            </h1>
                            <p class="admin-page-subtitle">Gestisci squadre, dirigenti e giocatori</p>
                        </div>
                        <div class="admin-page-header-actions">
                            <a href="/admin" class="btn btn-outline-secondary">
                                <i class="bi bi-arrow-left me-2"></i>
                                <span class="d-none d-sm-inline">Pannello</span>
                            </a>
                            <a href="/Logout" class="btn btn-outline-danger">
                                <i class="bi bi-box-arrow-right me-2"></i>
                                <span class="d-none d-sm-inline">Esci</span>
                            </a>
                        </div>
                    </header>

                    <!-- Section Header -->
                    <section class="section-header reveal reveal--fade-up reveal--delay-1">
                        <h2 class="section-title mb-0">
                            <i class="bi bi-list-ul me-2"></i>
                            Tutte le Squadre
                        </h2>
                        <button class="btn btn-primary crea-squadra-btn">
                            <i class="bi bi-plus-circle me-2"></i>
                            Crea Nuova Squadra
                        </button>
                    </section>

                    <!-- Tabella Squadre -->
                    <section class="admin-content-section fade-in">
                        <div class="admin-table-container">
                            <div class="table-responsive">
                                <table class="admin-table">
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>Nome Squadra</th>
                                            <th>Anno Fondazione</th>
                                            <th>Dirigenti</th>
                                            <th class="text-center">Giocatori</th>
                                            <th class="text-center">Azioni</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <% if (squadre && squadre.length > 0) { %>
                                            <% squadre.forEach(squadra => { %>
                                                <tr>
                                                    <td class="fw-semibold text-secondary"><%= squadra.id %></td>
                                                    <td>
                                                        <div class="fw-semibold"><%= squadra.nome %></div>
                                                    </td>
                                                    <td><%= squadra.Anno %></td>
                                                    <td>
                                                        <% if (squadra.dirigenti && squadra.dirigenti.length > 0) { %>
                                                            <div class="dirigenti-list">
                                                                <% squadra.dirigenti.forEach((dirigente, index) => { %>
                                                                    <span class="badge badge-secondary">
                                                                        <i class="bi bi-person-badge me-1"></i>
                                                                        <%= dirigente.nome %> <%= dirigente.cognome %>
                                                                    </span>
                                                                    <% if (index < squadra.dirigenti.length - 1) { %> <% } %>
                                                                <% }); %>
                                                            </div>
                                                        <% } else { %>
                                                            <span class="text-muted">Nessun dirigente</span>
                                                        <% } %>
                                                    </td>
                                                    <td class="text-center">
                                                        <span class="badge badge-info">
                                                            <i class="bi bi-people me-1"></i>
                                                            <%= squadra.numero_giocatori %>
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <div class="action-buttons">
                                                            <button class="btn btn-sm btn-outline-primary visualizza-btn" title="Visualizza" data-id="<%= squadra.id %>">
                                                                <i class="bi bi-eye"></i>
                                                            </button>
                                                            <a class="btn btn-sm btn-outline-warning modifica-btn" title="Modifica" href="/squadre/gestione/<%= squadra.id %>">
                                                                <i class="bi bi-pencil"></i>
                                                            </a>
                                                            <button class="btn btn-sm btn-outline-danger elimina-btn" title="Elimina" data-id="<%= squadra.id %>" data-nome="<%= squadra.nome %>">
                                                                <i class="bi bi-trash"></i>
                                                            </button>
                                                        </div>
                                                    </td>
                                                </tr>
                                            <% }); %>
                                        <% } else { %>
                                            <tr>
                                                <td colspan="6" class="text-center py-5">
                                                    <div class="empty-state">
                                                        <i class="bi bi-people empty-icon"></i>
                                                        <p class="empty-text">Nessuna squadra presente nel sistema</p>
                                                        <button class="btn btn-primary crea-squadra-btn">
                                                            <i class="bi bi-plus-circle me-1"></i> Crea la prima squadra
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        <% } %>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </section>

                </div>
            </main>
        </div>
    </div>

    <!-- Modal Crea Squadra -->
    <div class="modal fade" id="createModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-header-primary">
                    <h5 class="modal-title">
                        <i class="bi bi-plus-circle me-2"></i>
                        Crea Nuova Squadra
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="createForm">
                        <div class="mb-3">
                            <label for="nomeInput" class="form-label">Nome Squadra <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="nomeInput" name="nome" placeholder="Es. Juventus U19" required>
                        </div>
                        <div class="mb-3">
                            <label for="annoInput" class="form-label">Anno Fondazione <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="annoInput" name="anno_fondazione" min="1900" max="<%= new Date().getFullYear() %>" placeholder="<%= new Date().getFullYear() %>" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-2"></i>
                        Annulla
                    </button>
                    <button type="button" class="btn btn-primary" id="saveCreateBtn">
                        <i class="bi bi-check-circle me-2"></i>
                        Crea Squadra
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Dettagli Squadra -->
    <div class="modal fade" id="viewModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header modal-header-info">
                    <h5 class="modal-title" id="viewModalTitle">
                        <i class="bi bi-eye me-2"></i>
                        Dettagli Squadra
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="viewModalBody">
                    <!-- Contenuto caricato dinamicamente -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-2"></i>
                        Chiudi
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Elimina Squadra -->
    <div class="modal fade" id="deleteModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header modal-header-danger">
                    <h5 class="modal-title">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        Conferma Eliminazione
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Sei sicuro di voler eliminare la squadra <strong id="deleteSquadraNome"></strong>?</p>
                    <div class="alert alert-danger mb-0">
                        <i class="bi bi-exclamation-circle me-2"></i>
                        <strong>Attenzione:</strong> Questa azione eliminerà anche tutti i giocatori associati alla squadra e non può essere annullata.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle me-2"></i>
                        Annulla
                    </button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">
                        <i class="bi bi-trash me-2"></i>
                        Elimina Squadra
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js">
    <%- include('../../shared/views/partials/theme-includes') %></script>
    <script src="/assets/scripts/scroll-reveal.js"></script>
    <script src="/assets/scripts/components/AdminGlobal.js"></script>
    <script src="/assets/scripts/components/Admin.js"></script>
    <script src="/assets/scripts/components/GestioneSquadreAdmin.js"></script>

</body>
</html>
