<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventi - Asd BorgoVercelli 2022</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/css/bootstrap.min.css" rel="stylesheet">
    <%- include('../../shared/views/partials/theme-includes') %>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="/assets/styles/Navbar.css">
    <link rel="stylesheet" href="/assets/styles/Footer.css">
    <link rel="stylesheet" href="/assets/styles/Eventi.css">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.4/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
    <%- include('partials/navbar') %>

    <!-- Hero Section -->
    <section class="hero-section bg-gradient-primary text-white py-5">
        <div class="container-fluid px-4">
            <div class="row justify-content-center">
                <div class="col-12 col-md-8 col-lg-6 text-center">
                    <h1 class="display-4 fw-bold mb-4 animate__animated animate__fadeInDown">Eventi</h1>
                    <p class="lead fs-5 mb-0 animate__animated animate__fadeInUp animate__delay-1s">Scopri tutti i nostri eventi sportivi e sociali</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Search and Filters Section -->
    <section class="search-filters-section py-4 bg-light border-bottom">
        <div class="container-fluid px-4">
            <div class="row g-3 align-items-end">
                <div class="col-12 col-md-4">
                    <label for="tipoFilter" class="form-label fw-semibold">
                        <i class="fas fa-filter me-2"></i>Tipo
                    </label>
                    <select class="form-select form-select-lg" id="tipoFilter">
                        <option value="">Tutti i tipi</option>
                        <option value="Torneo">Torneo</option>
                        <option value="Partita">Partita</option>
                        <option value="Allenamento">Allenamento</option>
                        <option value="Evento Sociale">Evento Sociale</option>
                    </select>
                </div>
                <div class="col-12 col-md-4">
                    <label for="dateFilter" class="form-label fw-semibold">
                        <i class="fas fa-calendar me-2"></i>Data
                    </label>
                    <select class="form-select form-select-lg" id="dateFilter">
                        <option value="">Tutte le date</option>
                        <option value="oggi">Oggi</option>
                        <option value="domani">Domani</option>
                        <option value="settimana">Questa settimana</option>
                        <option value="mese">Questo mese</option>
                        <option value="futuri">Futuri</option>
                    </select>
                </div>
                <div class="col-12 col-md-4">
                    <div class="d-grid">
                        <button type="button" class="btn btn-outline-primary btn-lg" id="clearFilters">
                            <i class="fas fa-times me-2"></i>Pulisci filtri
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Events Grid -->
    <section class="events-section py-5">
        <div class="container-fluid px-4">
            <!-- Loading Spinner -->
            <div id="loadingSpinner" class="text-center py-5 d-none">
                <div class="spinner-border text-primary" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Caricamento...</span>
                </div>
                <p class="mt-3 text-muted">Caricamento eventi...</p>
            </div>

            <!-- No Results Message -->
            <div id="noResults" class="text-center py-5 d-none">
                <i class="fas fa-calendar-times fa-4x text-muted mb-4"></i>
                <h3 class="text-muted">Nessun evento trovato</h3>
                <p class="text-muted">Prova a modificare i filtri di ricerca</p>
            </div>

            <!-- Events Grid -->
            <div id="eventsGrid" class="row g-4">
                <% if (typeof eventi !== 'undefined' && eventi && eventi.length > 0) { %>
                    <% eventi.slice(0, 6).forEach(evento => { %>
                        <div class="col-12 col-md-6 col-lg-4">
                            <div class="event-card h-100 animate__animated animate__fadeInUp">
                                <div class="card-img-container">
                                    <img src="<%= (evento.immagine_url && evento.immagine_url.trim() !== '') ? evento.immagine_url : (evento.immagine && evento.immagine.url ? evento.immagine.url : '/assets/images/Campo.png') %>" alt="<%= evento.titolo %>" class="img-fluid"
                                         onerror="this.onerror=null; this.src='/assets/images/Campo.png'; this.alt='';">
                                    <div class="card-overlay">
                                        <span class="event-type-badge"><%= evento.tipo_evento || 'Evento' %></span>
                                    </div>
                                </div>
                                <div class="card-body d-flex flex-column">
                                    <div class="event-date mb-3">
                                        <i class="fas fa-calendar-alt me-2"></i>
                                        <span class="date-text">
                                            <%= evento.data_inizio ? new Date(evento.data_inizio).toLocaleDateString('it-IT', {
                                                weekday: 'long',
                                                year: 'numeric',
                                                month: 'long',
                                                day: 'numeric',
                                                hour: '2-digit',
                                                minute: '2-digit'
                                            }) : 'Data da definire' %>
                                        </span>
                                    </div>
                                    <h5 class="card-title fw-bold mb-3"><%= evento.titolo %></h5>
                                    <p class="card-text flex-grow-1 mb-3">
                                        <%= evento.descrizione ? evento.descrizione.replace(/<[^>]*>/g, '').substring(0, 120) + (evento.descrizione.length > 120 ? '...' : '') : 'Nessuna descrizione disponibile' %>
                                    </p>
                                    <div class="event-details mb-3">
                                        <div class="detail-item">
                                            <i class="fas fa-map-marker-alt me-2"></i>
                                            <span class="location-text"><%= evento.luogo || 'Luogo da definire' %></span>
                                        </div>
                                        <% if (evento.max_partecipanti && evento.max_partecipanti > 0) { %>
                                            <div class="detail-item">
                                                <i class="fas fa-users me-2"></i>
                                                <span class="participants-text">Max <%= evento.max_partecipanti %> partecipanti</span>
                                            </div>
                                        <% } %>
                                    </div>
                                    <a href="/evento/<%= evento.id %>" class="card-button mt-auto">
                                        <i class="fas fa-arrow-right me-2"></i>Scopri di più
                                    </a>
                                </div>
                            </div>
                        </div>
                    <% }); %>
                <% } else { %>
                    <div class="col-12">
                        <div id="noEvents" class="text-center py-5">
                            <i class="fas fa-calendar-times fa-4x text-muted mb-4"></i>
                            <h3 class="text-muted">Nessun evento disponibile</h3>
                            <p class="text-muted">Torna presto per scoprire i nostri prossimi eventi!</p>
                        </div>
                    </div>
                <% } %>
            </div>

            <!-- Load More Button -->
            <div class="text-center mt-5" id="loadMoreContainer">
                <button type="button" class="btn-load-more d-none" id="loadMoreBtn">
                    <i class="fas fa-plus me-2"></i>Carica altri eventi
                </button>
            </div>
        </div>
    </section>

    <!-- Event Card Template (hidden) -->
    <template id="eventCardTemplate">
        <div class="col-12 col-md-6 col-lg-4">
            <div class="event-card h-100 animate__animated animate__fadeInUp">
                <div class="card-img-container">
                    <img src="" alt="" class="img-fluid">
                    <div class="card-overlay">
                        <span class="event-type-badge"></span>
                    </div>
                </div>
                <div class="card-body d-flex flex-column">
                    <div class="event-date mb-3">
                        <i class="fas fa-calendar-alt me-2"></i>
                        <span class="date-text"></span>
                    </div>
                    <h5 class="card-title fw-bold mb-3"></h5>
                    <p class="card-text flex-grow-1 mb-3"></p>
                    <div class="event-details mb-3">
                        <div class="detail-item">
                            <i class="fas fa-map-marker-alt me-2"></i>
                            <span class="location-text"></span>
                        </div>
                        <div class="detail-item">
                            <i class="fas fa-users me-2"></i>
                            <span class="participants-text"></span>
                        </div>
                    </div>
                    <a href="#" class="card-button mt-auto">
                        <i class="fas fa-arrow-right me-2"></i>Scopri di più
                    </a>
                </div>
            </div>
        </div>
    </template>

    <%- include('partials/footer') %>

    <script type="module">
        import EventiManager from '/assets/scripts/eventiManager.js';
        new EventiManager(document.body);
    </script>
</body>
</html>